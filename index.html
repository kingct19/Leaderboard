
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Leaderboard</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }
    .leaderboard {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .rep-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      word-wrap: break-word;
    }
    .rep-card h2 {
      margin: 0;
      font-size: 1.2rem;
      color: #333;
    }
    .rep-card .stats {
      font-size: 0.95rem;
      color: #666;
    }
    .badge {
      display: inline-block;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      color: #fff;
      width: fit-content;
    }
    .legend { background: #f3c13a; }
    .pro { background: #3f87f5; }
    .rising { background: #45b36b; }
    #updated {
      text-align: center;
      font-size: 0.8rem;
      color: #888;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <div class="leaderboard">
    <p>Loading leaderboard...</p>
  </div>
  <div id="updated"></div>

  <script>
    async function loadLeaderboard() {
      const container = document.querySelector('.leaderboard');
      const updated = document.getElementById('updated');

      try {
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://opensheet.elk.sh/10E7jb6myCWLWcegQiyhNutyzGaSxzINSi5X1txCeLYo/Leaderboard');
        const res = await fetch(proxyUrl);
        const data = await res.json();

        container.innerHTML = ''; // Clear loading text

        data.forEach((row, index) => {
          const tier = row['ðŸ† Tier'] || row['ðŸŽ– Tier'] || '';
          const badgeClass = tier.includes('LEGEND') ? 'legend' :
                             tier.includes('PRO') ? 'pro' : 'rising';
          const rankEmoji = row['ðŸ† Rank'] || `#${index + 1}`;
          const name = row['ðŸ§‘ Rep Name'] || row['ðŸ‘¨â€ðŸ’¼ Rep Name'] || 'Unnamed';
          const deals = row['ðŸ“¦ Deals'] || '0';

          // Dynamically find key containing "net commission"
          const keys = Object.keys(row);
          const netKey = keys.find(k => k.toLowerCase().includes('net commission'));
          const net = netKey ? row[netKey] : '$0';

          const card = `
            <div class="rep-card">
              <h2>${rankEmoji} ${name}</h2>
              <div class="stats">Deals: ${deals} | Net: ${net}</div>
              <span class="badge ${badgeClass}">${tier}</span>
            </div>
          `;
          container.innerHTML += card;
        });

        const now = new Date();
        updated.textContent = `Last updated: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
      } catch (err) {
        container.innerHTML = '<p style="color:red">Failed to load leaderboard. Make sure the sheet is published and headers match expected format.</p>';
        console.error('Fetch error:', err);
      }
    }

    loadLeaderboard();
  </script>

</body>
</html>
